# Отчет о проекте: Система электронной коммерции (MVC)

## I. Общие положения

### 1. Назначение проекта
Проект представляет собой систему управления онлайн-магазином электронной коммерции. Целью является ознакомление с основными принципами разработки ПО, применение архитектуры MVC и стандартных шаблонов проектирования.

### 2. Описание предметной области
Система автоматизирует ключевые процессы интернет-магазина:
- **Управление пользователями**: Регистрация клиентов и администраторов.
- **Каталог товаров**: Просмотр ассортимента, сортировка.
- **Корзина покупок**: Добавление товаров и оформление заказов.
- **Продажи**: Обработка транзакций и списание остатков.
- **Отчетность**: Генерация аналитических отчетов о продажах.

### 3. Основные требования к проекту
#### Функциональные требования
- Реализация CRUD операций для пользователей.
- Просмотр каталога товаров с возможностью сортировки.
- Добавление товаров в корзину и оформление покупки.
- Генерация отчетов в фоновом режиме.

#### Нефункциональные требования
- **Масштабируемость**: Возможность вынесения компонентов в микросервисы.
- **Производительность**: Использование асинхронности и воркеров.
- **Поддерживаемость**: Строгая модульность (MVC).

### 4. Предположения и ограничения
- **Технологии**: Node.js, Express, MongoDB.
- **Инфраструктура**: Локальное развертывание.
- **Ограничения**: Упрощенная модель аутентификации (без реальных токенов).

---

## II. Архитектурные решения

### 1. Общая архитектура системы
Система состоит из следующих логических компонентов:
- **Фронтенд**: HTML/CSS/JS (EJS шаблоны).
- **Сервер приложений**: Express.js, обрабатывающий бизнес-логику.
- **База данных**: MongoDB для хранения сущностей.
- **Микросервисы (Логические)**: В проекте реализована модульная структура, где контроллеры и воркеры имитируют разделение на сервисы (Сервис Отчетов, Сервис Заказов).

### 2. Архитектура MVC
Принцип разделения ответственности в проекте:
- **Модель (Model)**: Отвечает за данные и бизнес-логику (`src/models`). Взаимодействует с БД Mongoose.
- **Представление (View)**: Отвечает за отображение данных пользователю (`src/views`). Использует EJS.
- **Контроллер (Controller)**: Принимает запросы, вызывает методы модели и выбирает представление (`src/controllers`).

### 3. Обоснование выбора технологий
- **Node.js**: Высокая производительность I/O, единый язык (JS) для всего стека.
- **Express**: Минималистичный стандарт де-факто для веб-серверов.
- **MongoDB**: Гибкая схема данных (NoSQL), идеально походит для товаров с разными атрибутами.

---

## III. Моделируемые сущности (Model)

### 1. Структуры данных
- **User (Пользователь)**: JSON-документ с полями `name`, `email`, `role`, `cart` (массив товаров).
- **Product (Товар)**: JSON-документ с полями `name`, `price`, `description`, `stock`.

### 2. Логика обработки данных
- **Валидация**: Реализована на уровне схем Mongoose (required поля, уникальные email).
- **Бизнес-правила**: Проверка наличия товара на складе перед покупкой (в Facade).

### 3. Хранение и обработка данных
- Данные хранятся в **MongoDB**.
- Логика взаимодействия инкапсулирована в моделях Mongoose и паттернах (Factory, Facade).

---

## IV. Представление (View)

### 1. Пользовательские интерфейсы
Реализованы основные экраны:
- **Каталог товаров (`productList.html`)**: Карточки товаров с кнопкой корзины.
- **Корзина (`cart.html`)**: Таблица выбранных товаров и итог.
- **Управление (`index.html`)**: Таблица пользователей (админка).
- **Отчеты (`report.html`)**: Дашборд с метриками.

### 2. Форматы вывода данных
- **HTML**: Основной формат для браузера.
- **JSON**: Используется для API ответов (в некоторых контроллерах).

### 3. UI-функционал
- **Apple-style Design**: Минимализм, Glassmorphism.
- **Анимации**: Плавное появление элементов (`fade-in`).
- **Сортировка**: Динамическое обновление списка товаров.

---

## V. Контроллеры (Controller)

### 1. Управление потоком действий
Жизненный цикл запроса:
1. Входящий HTTP запрос -> Роутер Express.
2. Контроллер (например, `ProductsController`) получает данные.
3. Вызов Модели или Фасада для бизнес-логики.
4. Рендеринг шаблона EJS с данными.
5. Отправка HTML ответа клиенту.

### 2. Реализация обработчиков событий
- **CRUD**: Обработчики `getAll`, `create`, `update`, `delete`.
- **Checkout**: Обработчик оформления заказа (`checkout`), вызывающий `ShopFacade`.
- **Parallel Task**: Обработчик отчета, запускающий Worker Thread.

### 3. Безопасность контроллеров
- **Валидация**: Строгая типизация и проверка обязательных полей в Mongoose защищает от некорректных данных.
- **Защита от атак**: Использование ODM Mongoose предотвращает базовые NoSQL-инъекции.
- **Аутентификация**: В рамках учебного проекта реализована упрощенная модель без токенов/сессий (роль передается при создании).
- **Обработка ошибок**: Централизованные блоки `try/catch` предотвращают утечку стека ошибок клиенту.

---

## VI. Примененные Паттерны Проектирования
Проект реализует все требуемые группы паттернов:
1. **Порождающие**: Singleton (Database), Factory (UserFactory).
2. **Структурные**: Adapter (PaymentAdapter), Facade (ShopFacade).
3. **Поведенческие**: Observer (ActivityLogger), Strategy (SortStrategy).
4. **Параллельные**: Producer-Consumer (ReportWorker).
